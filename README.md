# 2DCNN 注意事项



## 1 模型选择

- 选择 ResNet 模型

- 考虑使用预训练的模型
- 优化器用 SGD



## 2 数据集预处理

### 2.1 样本筛选

对每个病人，去掉没有肿瘤标记的slide，只选取有肿瘤标记的slide作为数据样本。

考虑是否以某一阈值 P 作为每张slide筛选的条件，即对于某一张slide：

- 肿瘤标记的像素点数量n > P : 则作为数据样本;
- 肿瘤标记的像素点数量n <= P : 则去掉这张slide;



### 2.2 spacing与分辨率问题

**统计不同分辨率的图片分别有多少，不同spacing的图片分别有多少。**

统计每个病人每张slide的spacing，2D处理时只考虑xy方向，更具excel表中spacing的倒数这一属性，对每一张slide进行resize**（具体操作还不清楚，如何根据spacing进行resize）**。

以小分辨率为基准进行resize，



### 2.3 切割

遍历所有图像后得到肿瘤的最大高度Hmax和宽度Wmax，得到一个切割box的高H和宽W（均略大于Hmax和Wmax，H=W），利用这个box对每张筛选后的slide进行切割，切割出只肿瘤附近的区域。

切割后再进行scale，因为经典ResNet的预训练模型等的输入为24×24。考虑如何裁剪。

pytorch有这一部分crop的函数。





### 2.4 正则化

pytorch的norm

均值：统计训练集（或是所有数据集）每一个样本每一个像素值求均值;

方差：同上求方差;



> 预处理的每一步操作后都将图片打印出来看一看。



## 3 训练集与测试集选择

- 方法1：
  - 测试集与训练集的每种类别的样本数的之间的比例相同，例如：
    - 测试集中：30%的类别0、30%类别1、30%的类别2
    - 训练集中：70%的类别0、70%类别1、70%的类别2
    - 这里的百分比是相对于总数据集的每一种类别的样本数
- 方法2：
  - class-weight：（不是很懂？？？）
    - 例如训练集的每种类别的样本数比例为10-5-2，则测试集的比例为2-5-10;





## 4 评估

- 统计每一个类别的准确率（如混淆矩阵）;

- 记录每一个病人的每一张slide的预测结果（包括标签），记录每一个病人的所有slide的预测结果的三种类别的分数‘/概率 均值、分布等;
- 首先保证训练集上的准确率达到98%+，然后再去保证测试集的准确率达到97%+;